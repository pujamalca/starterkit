<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>[x-cloak] { display: none !important; }</style>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto space-y-4">
        <h1 class="text-2xl font-bold">Search Debug Test</h1>

        <!-- Test 1: Simple Alpine.js test -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="font-bold mb-2">Test 1: Basic Alpine.js</h2>
            <div x-data="{ count: 0 }">
                <button @click="count++" class="px-4 py-2 bg-blue-500 text-white rounded">
                    Count: <span x-text="count"></span>
                </button>
            </div>
        </div>

        <!-- Test 2: Event dispatch test -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="font-bold mb-2">Test 2: Event Dispatch</h2>
            <div x-data="{ message: 'Waiting...' }" @test-event.window="message = 'Event received!'">
                <button onclick="window.dispatchEvent(new CustomEvent('test-event'))" class="px-4 py-2 bg-green-500 text-white rounded">
                    Trigger Event
                </button>
                <p class="mt-2" x-text="message"></p>
            </div>
        </div>

        <!-- Test 3: Modal test (like search) -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="font-bold mb-2">Test 3: Modal Test</h2>

            <button
                onclick="window.dispatchEvent(new CustomEvent('open-modal'))"
                class="px-4 py-2 bg-purple-500 text-white rounded cursor-pointer">
                Open Modal
            </button>

            <div x-data="{ open: false }"
                 @open-modal.window="open = true"
                 x-show="open"
                 x-cloak
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
                 style="display: none;">
                <div class="bg-white p-8 rounded-lg shadow-xl max-w-md">
                    <h3 class="text-xl font-bold mb-4">Modal Title</h3>
                    <p class="mb-4">This is a modal!</p>
                    <button @click="open = false" class="px-4 py-2 bg-red-500 text-white rounded">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Test 4: Search API test -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="font-bold mb-2">Test 4: Search API Test</h2>
            <div x-data="{
                query: '',
                results: [],
                loading: false,
                async search() {
                    if (this.query.length < 2) {
                        this.results = [];
                        return;
                    }
                    this.loading = true;
                    try {
                        const response = await fetch(`/api/search?q=${encodeURIComponent(this.query)}`);
                        const data = await response.json();
                        this.results = data.data || [];
                    } catch (error) {
                        console.error('Search error:', error);
                        this.results = [];
                    } finally {
                        this.loading = false;
                    }
                }
            }">
                <input
                    type="text"
                    x-model="query"
                    @input.debounce.300ms="search()"
                    placeholder="Type to search..."
                    class="w-full px-4 py-2 border rounded">

                <div class="mt-4">
                    <p x-show="loading">Loading...</p>
                    <p x-show="!loading && query && results.length === 0">No results</p>
                    <div x-show="!loading && results.length > 0">
                        <p class="font-bold">Results:</p>
                        <template x-for="result in results" :key="result.slug">
                            <div class="p-2 border-b">
                                <p class="font-semibold" x-text="result.title"></p>
                                <p class="text-sm text-gray-600" x-text="result.category"></p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Alpine.js version:', Alpine.version);
        console.log('Page loaded successfully');
    </script>
</body>
</html>
